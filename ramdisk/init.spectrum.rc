#######_____________________________________#######
#              Luuvy Kernel Tweak            	  #
#                    		                  #
#                                                 #
# SPECTRUM KERNEL MANAGER                         #
# Ramdisk file for profile based kernel management#
# Implimentation inspired by Franco's fku profiles#
#                                                 #
# 						  # 
#######_____________________________________#######

# Initialization

on init
 ## zram madness
    exec u:r:init:s0 -- /system/bin/swapoff /dev/block/zram0
    exec u:r:su:s0 -- /system/bin/swapoff /dev/block/zram0
    exec u:r:magisk:s0 -- /system/bin/swapoff /dev/block/zram0
    exec u:r:supersu:s0 -- /system/bin/swapoff /dev/block/zram0
    write /sys/block/zram0/reset 1
    ## write /sys/block/zram0/comp_algorithm lz4
    write /sys/block/zram0/disksize 2147483648
    ##write /sys/block/zram0/max_comp_streams 1

on post-fs
    exec u:r:init:s0 -- /system/bin/mkswap /dev/block/zram0
    exec u:r:init:s0 -- /system/bin/swapon /dev/block/zram0
    exec u:r:su:s0 -- /system/bin/mkswap /dev/block/zram0
    exec u:r:su:s0 -- /system/bin/swapon /dev/block/zram0
    exec u:r:magisk:s0 -- /system/bin/mkswap /dev/block/zram0
    exec u:r:magisk:s0 -- /system/bin/swapon /dev/block/zram0
    exec u:r:supersu:s0 -- /system/bin/mkswap /dev/block/zram0
    exec u:r:supersu:s0 -- /system/bin/swapon /dev/block/zram0

on property:sys.boot_completed=1
   # Set default profile on first boot
   setprop persist.spectrum.profile 0
   ## exec u:r:init:s0 -- /system/vendor/etc/init/init.spectrum.sh
   ## exec u:r:init:s0 root root -- /system/vendor/etc/init/init.spectrum.sh
   ## exec u:r:su:s0 root root -- /system/vendor/etc/init/init.spectrum.sh
   ## exec u:r:magisk:s0 root root -- /system/vendor/etc/init/init.spectrum.sh
   ## exec u:r:supersu:s0 root root -- /system/vendor/etc/init/init.spectrum.sh
   # Enable Spectrum support
   setprop spectrum.support 1
   # Add kernel name
   setprop persist.spectrum.kernel Luuvy.C.

# Balance (default profile)
on property:persist.spectrum.profile=0
	#/* Max CPU control Big*/
	  chmod 644 /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq
	  write /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq 1401000
	  chmod 444 /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq
	#/* Min CPU control Big*/
	  chmod 644 /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq
	  write /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq 960000
	  chmod 444 /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq
	 #/* Max CPU control little*/
	  chmod 644 /sys/devices/system/cpu/cpu4/cpufreq/scaling_max_freq
	  write /sys/devices/system/cpu/cpu4/cpufreq/scaling_max_freq 1094400
	  chmod 444 /sys/devices/system/cpu/cpu4/cpufreq/scaling_max_freq
	#/* Min CPU control little*/
	  chmod 644 /sys/devices/system/cpu/cpu4/cpufreq/scaling_min_freq
	  write /sys/devices/system/cpu/cpu4/cpufreq/scaling_min_freq 768000
	  chmod 444 /sys/devices/system/cpu/cpu4/cpufreq/scaling_min_freq
	#/*lainnya*/
	  write /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor schedutil
	  write /sys/devices/system/cpu/cpu4/cpufreq/scaling_governor schedutil

	  chmod 644 /sys/module/workqueue/parameters/power_efficient
	  write /sys/module/workqueue/parameters/power_efficient y

	# GPU
	  write /sys/class/kgsl/kgsl-3d0/max_gpuclk 475000000
	  write /sys/class/kgsl/kgsl-3d0/min_clock_mhz 216
	  write /sys/class/kgsl/kgsl-3d0/devfreq/governor msm-adreno-tz
	  write /sys/kernel/gpu/gpu_min_clock 216
	  write /sys/kernel/gpu/gpu_max_clock 475

	# Misc
	  write /proc/sys/net/ipv4/tcp_congestion_control bbr

# Performance
on property:persist.spectrum.profile=1
	  #/* Max CPU control Big*/
	  chmod 644 /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq
	  write /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq 1401000
	  chmod 444 /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq
	#/* Min CPU control Big*/
	  chmod 644 /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq
	  write /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq 960000
	  chmod 444 /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq
	 #/* Max CPU control little*/
	  chmod 644 /sys/devices/system/cpu/cpu4/cpufreq/scaling_max_freq
	  write /sys/devices/system/cpu/cpu4/cpufreq/scaling_max_freq 1094400
	  chmod 444 /sys/devices/system/cpu/cpu4/cpufreq/scaling_max_freq
	#/* Min CPU control little*/
	  chmod 644 /sys/devices/system/cpu/cpu4/cpufreq/scaling_min_freq
	  write /sys/devices/system/cpu/cpu4/cpufreq/scaling_min_freq 768000
	  chmod 444 /sys/devices/system/cpu/cpu4/cpufreq/scaling_min_freq
	#/*lainnya*/
	  write /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor performance
	  write /sys/devices/system/cpu/cpu4/cpufreq/scaling_governor performance
	  chmod 644 /sys/module/workqueue/parameters/power_efficient
	  write /sys/module/workqueue/parameters/power_efficient N

	# GPU
	  write /sys/class/kgsl/kgsl-3d0/max_gpuclk 475000000
	  write /sys/class/kgsl/kgsl-3d0/min_clock_mhz 300
	  write /sys/class/kgsl/kgsl-3d0/devfreq/governor msm-adreno-tz
	  write /sys/kernel/gpu/gpu_min_clock 300
	  write /sys/kernel/gpu/gpu_max_clock 475

	# Misc
	  write /proc/sys/net/ipv4/tcp_congestion_control bbr


# Battery
on property:persist.spectrum.profile=2
	  #/* Max CPU control Big*/
	  chmod 644 /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq
	  write /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq 1401000
	  chmod 444 /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq
	#/* Min CPU control Big*/
	  chmod 644 /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq
	  write /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq 960000
	  chmod 444 /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq
	 #/* Max CPU control little*/
	  chmod 644 /sys/devices/system/cpu/cpu4/cpufreq/scaling_max_freq
	  write /sys/devices/system/cpu/cpu4/cpufreq/scaling_max_freq 1094400
	  chmod 444 /sys/devices/system/cpu/cpu4/cpufreq/scaling_max_freq
	#/* Min CPU control little*/
	  chmod 644 /sys/devices/system/cpu/cpu4/cpufreq/scaling_min_freq
	  write /sys/devices/system/cpu/cpu4/cpufreq/scaling_min_freq 768000
	  chmod 444 /sys/devices/system/cpu/cpu4/cpufreq/scaling_min_freq
	#/*lainnya*/
	  write /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor powersave
	  write /sys/devices/system/cpu/cpu4/cpufreq/scaling_governor powersave
	  chmod 644 /sys/module/workqueue/parameters/power_efficient
	  write /sys/module/workqueue/parameters/power_efficient Y

	# GPU
	  write /sys/class/kgsl/kgsl-3d0/max_gpuclk 450000000
	  write /sys/class/kgsl/kgsl-3d0/min_clock_mhz 216
	  write /sys/class/kgsl/kgsl-3d0/devfreq/governor msm-adreno-tz
	  write /sys/kernel/gpu/gpu_min_clock 216
	  write /sys/kernel/gpu/gpu_max_clock 450

	# Misc
	  write /proc/sys/net/ipv4/tcp_congestion_control bbr

# Gaming
on property:persist.spectrum.profile=3
	  #/* Max CPU control Big*/
	  chmod 644 /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq
	  write /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq 1401000
	  chmod 444 /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq
	#/* Min CPU control Big*/
	  chmod 644 /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq
	  write /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq 960000
	  chmod 444 /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq
	 #/* Max CPU control little*/
	  chmod 644 /sys/devices/system/cpu/cpu4/cpufreq/scaling_max_freq
	  write /sys/devices/system/cpu/cpu4/cpufreq/scaling_max_freq 1094400
	  chmod 444 /sys/devices/system/cpu/cpu4/cpufreq/scaling_max_freq
	#/* Min CPU control little*/
	  chmod 644 /sys/devices/system/cpu/cpu4/cpufreq/scaling_min_freq
	  write /sys/devices/system/cpu/cpu4/cpufreq/scaling_min_freq 768000
	  chmod 444 /sys/devices/system/cpu/cpu4/cpufreq/scaling_min_freq
	#/*lainnya*/
	  write /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor performance
	  write /sys/devices/system/cpu/cpu4/cpufreq/scaling_governor performance
	  chmod 644 /sys/module/workqueue/parameters/power_efficient
	  write /sys/module/workqueue/parameters/power_efficient N

	# GPU
	  write /sys/class/kgsl/kgsl-3d0/max_gpuclk 475000000
	  write /sys/class/kgsl/kgsl-3d0/min_clock_mhz 375
	  write /sys/class/kgsl/kgsl-3d0/devfreq/governor msm-adreno-tz
	  write /sys/kernel/gpu/gpu_min_clock 375
	  write /sys/kernel/gpu/gpu_max_clock 475

	# Misc
	  write /proc/sys/net/ipv4/tcp_congestion_control bbr
